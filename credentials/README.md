# OT Registrar Credentials

## Files

- `*.pem` — These are domain and CA root key and certificate files from the Thread Group. They are used to generate the `*.p12` files.

- `*.p12` — Keystore files generated by the [CredentialGenerator] tool. They are used by OT Registrar.

## Keystore structure

OT Registrar programs need a keystore file with below structure:

| Alias        | Content                            | Signer      |
|:-------------|:-----------------------------------|:------------|
| domainca     | domain CA root key and certificate | self-signed |
| registrar    | registrar key and certificate      | domainca    |
| commissioner | commissioner key and certificate   | domainca    |
| masa         | MASA root key and certificate      | self-signed |
| pledge       | pledge key and certificate         | masa        |

**The password of the keystore and all private keys is _`OpenThread`_.**

### Explore the keystore

Extract all nodes in the keystore with [keytool](https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html):

```bash
keytool -list -keystore credentials/threadgroup-5f9d307c.p12 -storepass OpenThread
# Keystore type: PKCS12
# Keystore provider: SUN
#
# Your keystore contains 5 entries
#
# commissioner, Jun 20, 2019, PrivateKeyEntry,
# Certificate fingerprint (SHA-256): 5D:76:44:FA:B8:D3:B8:6A:A8:41:AE:7D:1F:F5:B2:2E:79:94:1C:91:AD:8B:30:E4:5C:60:DA:8D:C4:76:B2:DF
# domainca, Jun 20, 2019, PrivateKeyEntry,
# Certificate fingerprint (SHA-256): EB:4E:8D:CF:EB:C2:A3:EE:30:A7:04:FC:D5:9E:9D:A8:70:91:57:A0:CE:1F:66:97:4A:B4:CD:8A:E1:A8:E5:92
# masa, Jun 19, 2019, PrivateKeyEntry,
# Certificate fingerprint (SHA-256): D2:34:28:42:2B:7F:35:82:CA:72:90:3D:AA:C5:2B:50:F1:DF:69:EE:55:7A:0A:B9:49:8A:35:F1:9E:1F:95:A6
# pledge, Jun 19, 2019, PrivateKeyEntry,
# Certificate fingerprint (SHA-256): D8:6D:DA:7F:B1:E1:55:75:1A:80:71:33:A5:1C:50:C7:96:DF:B5:DB:06:09:EC:97:27:11:A3:CF:99:C4:74:DA
# registrar, Jun 20, 2019, PrivateKeyEntry,
# Certificate fingerprint (SHA-256): 5D:76:44:FA:B8:D3:B8:6A:A8:41:AE:7D:1F:F5:B2:2E:79:94:1C:91:AD:8B:30:E4:5C:60:DA:8D:C4:76:B2:DF
```

Display a selected certificate in readable format:

```bash
keytool -list -keystore credentials/threadgroup-5f9d307c.p12 -storepass OpenThread -alias pledge -v
# Alias name: pledge
# Creation date: Jun 19, 2019
# Entry type: PrivateKeyEntry
# Certificate chain length: 2
# ...
```

To explore and manage the keyetore with a GUI, we recommend the [Keystore Explorer](https://keystore-explorer.org/index.html) tool.

## Credential generator

The certificates needed by the Thread CCM extension features some attributes and fields that cannot be easily generated by out-of-box tools (for example, openssl and java keytool). To simplify the generation of credentials, OT Registrar provides a `CredentialGenerator` tool:

```bash
java -cp target/ot-registrar-0.1-SNAPSHOT-jar-with-dependencies.jar com.google.openthread.tools.CredentialGenerator -c credentials/domainca_cert.pem credentials/domainca_private.pem -m credentials/masa_cert.pem credentials/masa_private.pem -o test_credentials.p12
```

Use the `-h` option to learn what arguments are available:

```bash
java -cp target/ot-registrar-0.1-SNAPSHOT-jar-with-dependencies.jar com.google.openthread.tools.CredentialGenerator -h
# usage: CredentialGenerator [-c <domain-ca-cert> <domain-ca-key>] [-m
#                            <masa-ca-cert> <masa-ca-key>] -o <output-file>
#  -c,--ca <arg>            domain CA root key & certificate file
#  -d,--dump                dump the certificates as separate PEM files
#  -h,--help                print this message
#  -m,--masa <arg>          MASA CA root key & certificate file
#  -o,--out <output-file>   the keystore file write to
```
